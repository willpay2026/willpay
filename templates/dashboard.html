<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will-Pay Dashboard</title>
    <style>
        body { background-color: #000; color: #bfa141; font-family: sans-serif; text-align: center; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { width: 90%; max-width: 400px; padding: 25px; border: 2px solid #bfa141; border-radius: 40px; background-color: #000; position: relative; }
        .logo-willpay { width: 90px; margin-bottom: 15px; }
        .monto-saldo { font-size: 42px; font-weight: bold; margin: 10px 0; }
        
        button { width: 100%; padding: 14px; margin: 8px 0; border: 2px solid #bfa141; border-radius: 12px; background: transparent; color: #bfa141; font-weight: bold; cursor: pointer; }
        .btn-activo { background: #bfa141; color: #000; } /* Estilo para el botÃ³n PAGAR cuando se presiona */
        
        /* ðŸ“± ESTILO DEL INPUT PARA EL TABLERO NUMÃ‰RICO */
        .input-monto { 
            width: 80%; padding: 15px; margin: 15px 0; border: 2px solid #fff; border-radius: 15px; 
            background: #1a1a1a; color: #bfa141; font-size: 32px; text-align: center; font-weight: bold;
            display: none; /* Oculto hasta que den click en PAGAR */
        }

        #seccion-recargas, #reader { display: none; margin-top: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <img src="/static/logowillpay.png" class="logo-willpay" alt="Will-Pay">
        <p style="opacity: 0.7; font-size: 14px;">Saldo Disponible</p>
        <h1 class="monto-saldo">Bs. {{ "%.2f"|format(u.saldo_bs) }}</h1>

        <button onclick="toggleRecargas()">RECARGAR</button>

        <div id="seccion-recargas">
            <p style="font-size: 11px;">PAGO MÃ“VIL: <b>04126602555 | 13496133 | BANESCO</b></p>
            <form action="/solicitar_recarga" method="POST">
                <input type="number" name="monto" placeholder="Monto Bs." required inputmode="decimal" style="width:80%; padding:8px; margin:5px; border-radius:8px;">
                <input type="text" name="referencia" placeholder="Referencia" required style="width:80%; padding:8px; margin:5px; border-radius:8px;">
                <button type="submit" style="border-color: #2ecc71; color: #2ecc71; width: 85%;">ENVIAR RECARGA</button>
            </form>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button id="btnPagar" onclick="activarPago()" style="flex: 1;">PAGAR</button>
            <button onclick="activarCamara()" style="flex: 1; border-color: #333; color: #333;">COBRAR</button>
        </div>

        <input type="number" id="montoPago" class="input-monto" placeholder="0.00" inputmode="decimal">

        <div id="reader"></div>

        <a href="/logout" style="color: #ff4d4d; text-decoration: none; font-size: 12px; margin-top: 20px; display: block;">Cerrar SesiÃ³n</a>
    </div>

    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        function toggleRecargas() {
            const p = document.getElementById('seccion-recargas');
            p.style.display = (p.style.display === 'none') ? 'block' : 'none';
        }

        // ðŸš€ FUNCIÃ“N PARA ABRIR EL TABLERO DE NÃšMEROS
        function activarPago() {
            const input = document.getElementById('montoPago');
            const btn = document.getElementById('btnPagar');
            
            // Alternar visibilidad
            if (input.style.display === 'block') {
                input.style.display = 'none';
                btn.classList.remove('btn-activo');
            } else {
                input.style.display = 'block';
                btn.classList.add('btn-activo');
                input.focus(); // Esto hace que el teclado suba solo
            }
        }

        function activarCamara() {
            const reader = document.getElementById('reader');
            reader.style.display = 'block';
            const html5QrCode = new Html5Qrcode("reader");
            html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (text) => {
                alert("Escaneado: " + text);
                html5QrCode.stop();
                reader.style.display = 'none';
            });
        }
    </script>
</body>
</html>
