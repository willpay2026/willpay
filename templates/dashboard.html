<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will-Pay | Dashboard</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; padding: 20px; }
        .box { border: 2px solid #bfa141; border-radius: 30px; padding: 25px; max-width: 400px; margin: auto; }
        .monto { font-size: 35px; color: #bfa141; margin: 15px 0; font-weight: bold; }
        .btn { background: #bfa141; color: #000; padding: 15px; width: 100%; border-radius: 15px; border: none; font-weight: bold; cursor: pointer; }
        #reader { width: 100%; margin-top: 15px; border-radius: 15px; overflow: hidden; display: none; }
    </style>
</head>
<body>
    <div class="box">
        <img src="/static/logonuevo.png" width="120">
        <h2>Hola, {{ u.nombre }}</h2>
        <div class="monto">Bs. {{ "%.2f"|format(u.saldo_bs) }}</div>
        
        <div id="reader"></div>
        <button id="btn" class="btn" onclick="escanear()">ðŸ“· ESCANEAR QR</button>

        <h4 style="margin-top:30px; color:#bfa141; border-bottom:1px solid #333;">Ãšltimos Pagos</h4>
        {% for m in movimientos %}
        <div style="text-align:left; font-size:12px; padding:10px 0; border-bottom:1px solid #111;">
            A: {{ m.receptor_n }} <span style="float:right; color:#ff4d4d;">-Bs. {{ m.monto }}</span>
        </div>
        {% endfor %}
    </div>

    <script>
        function escanear() {
            document.getElementById('reader').style.display = 'block';
            const scanner = new Html5Qrcode("reader");
            scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (id) => {
                let monto = prompt("Monto a pagar:");
                if(monto) {
                    scanner.stop().then(() => {
                        fetch('/ejecutar_pago_qr', {
                            method: 'POST', headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({receptor_id: id, monto: monto})
                        }).then(res => res.json()).then(data => {
                            if(data.status == 'ok') window.location.href = '/comprobante/' + data.pago_id;
                        });
                    });
                }
            });
        }
    </script>
</body>
</html>
